# ====================================
# API GATEWAY CONFIGURATION
# ====================================

# Gateway Configuration
gateway.enabled=true
gateway.version=1.0.0

# ====================================
# RESILIENCE4J CONFIGURATION
# ====================================

# Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.register-health-indicator=true
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.minimum-number-of-calls=10
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.permitted-number-of-calls-in-half-open-state=5
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.sliding-window-size=100
resilience4j.circuitbreaker.instances.gatewayCircuitBreaker.sliding-window-type=COUNT_BASED

# Retry Configuration
resilience4j.retry.instances.gatewayRetry.max-attempts=3
resilience4j.retry.instances.gatewayRetry.wait-duration=500ms
resilience4j.retry.instances.gatewayRetry.enable-exponential-backoff=true
resilience4j.retry.instances.gatewayRetry.exponential-backoff-multiplier=2
resilience4j.retry.instances.gatewayRetry.max-wait-duration=5s

# Time Limiter Configuration
resilience4j.timelimiter.instances.gatewayTimeLimiter.timeout-duration=10s
resilience4j.timelimiter.instances.gatewayTimeLimiter.cancel-running-future=true

# Rate Limiter Configuration
resilience4j.ratelimiter.instances.gatewayRateLimiter.limit-for-period=100
resilience4j.ratelimiter.instances.gatewayRateLimiter.limit-refresh-period=1m
resilience4j.ratelimiter.instances.gatewayRateLimiter.timeout-duration=5s

# ====================================
# SERVICE-SPECIFIC CIRCUIT BREAKERS
# ====================================

# Auth Service Circuit Breaker
resilience4j.circuitbreaker.instances.authService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.authService.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.authService.minimum-number-of-calls=5

# Customer Service Circuit Breaker
resilience4j.circuitbreaker.instances.customerService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.customerService.wait-duration-in-open-state=30s

# Account Service Circuit Breaker
resilience4j.circuitbreaker.instances.accountService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.accountService.wait-duration-in-open-state=30s

# Transaction Service Circuit Breaker
resilience4j.circuitbreaker.instances.transactionService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.transactionService.wait-duration-in-open-state=30s

# Payment Service Circuit Breaker
resilience4j.circuitbreaker.instances.paymentService.failure-rate-threshold=60
resilience4j.circuitbreaker.instances.paymentService.wait-duration-in-open-state=45s
resilience4j.circuitbreaker.instances.paymentService.minimum-number-of-calls=15

# Fraud Service Circuit Breaker
resilience4j.circuitbreaker.instances.fraudService.failure-rate-threshold=40
resilience4j.circuitbreaker.instances.fraudService.wait-duration-in-open-state=60s

# Statement Service Circuit Breaker
resilience4j.circuitbreaker.instances.statementService.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.statementService.wait-duration-in-open-state=30s

# Audit Service Circuit Breaker (disabled - audit should always work)
resilience4j.circuitbreaker.instances.auditService.failure-rate-threshold=100
resilience4j.circuitbreaker.instances.auditService.wait-duration-in-open-state=10s

# ====================================
# ACTUATOR CONFIGURATION FOR GATEWAY
# ====================================

# Expose resilience4j endpoints
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# ====================================
# LOGGING CONFIGURATION FOR GATEWAY
# ====================================

# Gateway logging
logging.level.com.RRBank.banking.gateway=DEBUG
logging.level.io.github.resilience4j=DEBUG

# Request/Response logging
logging.level.org.springframework.web.filter.CommonsRequestLoggingFilter=DEBUG
