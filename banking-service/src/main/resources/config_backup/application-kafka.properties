# ====================================
# KAFKA CONFIGURATION FOR PHASE 4
# ====================================

# ====================================
# KAFKA BROKER CONFIGURATION
# ====================================

# Kafka bootstrap servers
spring.kafka.bootstrap-servers=localhost:9092

# ====================================
# KAFKA PRODUCER CONFIGURATION
# ====================================

# Producer acknowledgment
spring.kafka.producer.acks=1

# Retries
spring.kafka.producer.retries=3

# Batch size
spring.kafka.producer.batch-size=16384

# Linger time (ms)
spring.kafka.producer.properties.linger.ms=10

# Buffer memory
spring.kafka.producer.buffer-memory=33554432

# Compression
spring.kafka.producer.compression-type=snappy

# Serialization
spring.kafka.producer.key-serializer=org.apache.kafka.common.serialization.StringSerializer
spring.kafka.producer.value-serializer=org.springframework.kafka.support.serializer.JsonSerializer

# Idempotence (exactly-once delivery)
spring.kafka.producer.properties.enable.idempotence=true

# Max in-flight requests
spring.kafka.producer.properties.max.in.flight.requests.per.connection=5

# ====================================
# KAFKA CONSUMER CONFIGURATION
# ====================================

# Consumer group ID
spring.kafka.consumer.group-id=banking-consumer-group

# Auto offset reset
spring.kafka.consumer.auto-offset-reset=earliest

# Auto commit
spring.kafka.consumer.enable-auto-commit=false

# Max poll records
spring.kafka.consumer.max-poll-records=500

# Session timeout
spring.kafka.consumer.properties.session.timeout.ms=30000

# Max poll interval
spring.kafka.consumer.properties.max.poll.interval.ms=300000

# Deserialization
spring.kafka.consumer.key-deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.kafka.consumer.value-deserializer=org.springframework.kafka.support.serializer.JsonDeserializer

# Trusted packages for deserialization
spring.kafka.consumer.properties.spring.json.trusted.packages=*

# ====================================
# KAFKA LISTENER CONFIGURATION
# ====================================

# Concurrency
spring.kafka.listener.concurrency=3

# Acknowledgment mode
spring.kafka.listener.ack-mode=manual

# Error handling
spring.kafka.listener.missing-topics-fatal=false

# ====================================
# KAFKA ADMIN CONFIGURATION
# ====================================

# Auto create topics
spring.kafka.admin.auto-create=true

# Operation timeout
spring.kafka.admin.properties.request.timeout.ms=30000

# ====================================
# TOPIC-SPECIFIC CONFIGURATIONS
# ====================================

# Account Events
kafka.topics.account-events.name=account.events
kafka.topics.account-events.partitions=3
kafka.topics.account-events.replication-factor=1
kafka.topics.account-events.retention-ms=604800000

# Customer Events
kafka.topics.customer-events.name=customer.events
kafka.topics.customer-events.partitions=3
kafka.topics.customer-events.replication-factor=1
kafka.topics.customer-events.retention-ms=604800000

# Transaction Events
kafka.topics.transaction-events.name=transaction.events
kafka.topics.transaction-events.partitions=6
kafka.topics.transaction-events.replication-factor=1
kafka.topics.transaction-events.retention-ms=2592000000

# Payment Events
kafka.topics.payment-events.name=payment.events
kafka.topics.payment-events.partitions=3
kafka.topics.payment-events.replication-factor=1
kafka.topics.payment-events.retention-ms=2592000000

# Notification Events
kafka.topics.notification-events.name=notification.events
kafka.topics.notification-events.partitions=3
kafka.topics.notification-events.replication-factor=1
kafka.topics.notification-events.retention-ms=604800000

# Fraud Alerts
kafka.topics.fraud-alerts.name=fraud.alerts
kafka.topics.fraud-alerts.partitions=3
kafka.topics.fraud-alerts.replication-factor=1
kafka.topics.fraud-alerts.retention-ms=7776000000

# Statement Events
kafka.topics.statement-events.name=statement.events
kafka.topics.statement-events.partitions=2
kafka.topics.statement-events.replication-factor=1
kafka.topics.statement-events.retention-ms=2592000000

# Audit Events
kafka.topics.audit-events.name=audit.events
kafka.topics.audit-events.partitions=6
kafka.topics.audit-events.replication-factor=1
kafka.topics.audit-events.retention-ms=31536000000

# Dead Letter Queue
kafka.topics.dlq.name=dlq.events
kafka.topics.dlq.partitions=3
kafka.topics.dlq.replication-factor=1
kafka.topics.dlq.retention-ms=7776000000

# Retry Queue
kafka.topics.retry.name=retry.events
kafka.topics.retry.partitions=3
kafka.topics.retry.replication-factor=1
kafka.topics.retry.retention-ms=604800000

# ====================================
# CONSUMER GROUP CONFIGURATIONS
# ====================================

# Transaction Processor Group
kafka.consumer.transaction-processor.group-id=transaction-processor-group
kafka.consumer.transaction-processor.concurrency=5

# Notification Service Group
kafka.consumer.notification-service.group-id=notification-service-group
kafka.consumer.notification-service.concurrency=3

# Fraud Detector Group
kafka.consumer.fraud-detector.group-id=fraud-detector-group
kafka.consumer.fraud-detector.concurrency=4

# Audit Logger Group
kafka.consumer.audit-logger.group-id=audit-logger-group
kafka.consumer.audit-logger.concurrency=6

# Statement Generator Group
kafka.consumer.statement-generator.group-id=statement-generator-group
kafka.consumer.statement-generator.concurrency=2

# Analytics Group
kafka.consumer.analytics.group-id=analytics-group
kafka.consumer.analytics.concurrency=3

# ====================================
# ERROR HANDLING CONFIGURATION
# ====================================

# Retry configuration
kafka.retry.max-attempts=3
kafka.retry.backoff-initial-interval=1000
kafka.retry.backoff-multiplier=2.0
kafka.retry.backoff-max-interval=10000

# Dead letter queue configuration
kafka.dlq.enabled=true
kafka.dlq.include-headers=true
kafka.dlq.include-original-message=true

# ====================================
# MONITORING CONFIGURATION
# ====================================

# Enable metrics
kafka.metrics.enabled=true

# Metric tags
kafka.metrics.tags.application=RR-Banking-Application
kafka.metrics.tags.environment=${spring.profiles.active}

# Consumer lag monitoring
kafka.monitoring.consumer-lag.enabled=true
kafka.monitoring.consumer-lag.threshold=1000
kafka.monitoring.consumer-lag.check-interval=60000

# ====================================
# LOGGING
# ====================================

logging.level.org.apache.kafka=INFO
logging.level.org.springframework.kafka=DEBUG
logging.level.com.RRBank.banking.kafka=DEBUG
logging.level.com.RRBank.banking.consumer=DEBUG

# ====================================
# DEVELOPMENT OVERRIDES
# ====================================

# For H2 development (Kafka disabled)
#spring.kafka.enabled=false

# ====================================
# PRODUCTION OVERRIDES
# ====================================

# For production, set these via environment variables:
# KAFKA_BOOTSTRAP_SERVERS=kafka1:9092,kafka2:9092,kafka3:9092
# KAFKA_PRODUCER_ACKS=all
# KAFKA_CONSUMER_AUTO_OFFSET_RESET=earliest
# KAFKA_REPLICATION_FACTOR=3
